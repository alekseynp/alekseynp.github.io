
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Aleksey Nozdryn-Plotnicki</title>
  <meta name="author" content="Aleksey Nozdryn-Plotnicki">

  
  <meta name="description" content="Here are some more visuals based on my analysis of average shot locations from the NBA Regular Season 2012-13&hellip; See previously: Average Made &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://alekseynp.com/posts/3">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Aleksey Nozdryn-Plotnicki" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=Fjalla+One" rel="stylesheet" type="text/css">
<!--- MathJax Configuration -->
<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-56820808-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Aleksey Nozdryn-Plotnicki</a></h1>
  
    <h2>blog, portfolio, etc.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscribe" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="25" height="25" viewbox="0 0 100 100"><path class="social" d="M 13.310204,73.332654 C 5.967347,73.332654 0,79.322448 0,86.621428 c 0,7.338776 5.967347,13.262246 13.310204,13.262246 7.370408,0 13.328572,-5.92245 13.328572,-13.262246 0,-7.29898 -5.958164,-13.288774 -13.328572,-13.288774 z M 0.01530612,33.978572 V 53.143878 C 12.493878,53.143878 24.229592,58.02347 33.068368,66.865306 41.894898,75.685714 46.767346,87.47449 46.767346,100 h 19.25 C 66.017346,63.592858 36.4,33.979592 0.01530612,33.978572 l 0,0 z M 0.03877552,0 V 19.17449 C 44.54796,19.17551 80.77551,55.437756 80.77551,100 H 100 C 100,44.87653 55.15102,0 0.03877552,0 z"></path></svg></a></li>
  
</ul>
  
  
  
  
  
  
  
    
      <form action="https://www.google.com/search" method="get">
        <fieldset role="search">
          <input type="hidden" name="q" value="site:alekseynp.com" />
    
          <input class="search" type="text" name="q" results="0" placeholder="Search"/>
        </fieldset>
      </form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/about/">About</a></li>
  <li><a href="/portfolio/">Portfolio</a></li>
  <li><a href="/topics/">Topics</a></li>
  <li><a href="/archives/">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/11/05/more-on-averages-shot-locations/">More on Averages Shot Locations</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-11-05T07:58:08-08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>5</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>7:58 am</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>Here are some more visuals based on my analysis of average shot locations from the NBA Regular Season 2012-13&hellip;</p>

<p>See previously:</p>

<ul>
<li><p><a href="http://alekseynp.com/2013/10/13/average-made-shot-location-nba-regular-season-2012-13/">Average Made Shot Location - NBA Regular Season 2012-13</a></p></li>
<li><p><a href="http://alekseynp.com/2013/10/24/update-average-shot-locations-nba-regular-season-2012-13/">Update: Average shot locations - NBA Regular Season 2012-13</a></p></li>
</ul>


<p>Average Location of Shots Made - NBA 2012-13 Regular Season by teams and against teams&hellip;</p>

<p><a href="http://alekseynp.com/wp-content/uploads/2013/11/for_and_against_640w1.png"><img src="http://alekseynp.com/wp-content/uploads/2013/11/for_and_against_640w1.png" alt="for_and_against_640w" /></a></p>

<ul>
<li><p>Shots made by a team show more variation than shots made against a team. Where you shoot from depends more on who you are than who you are playing against &ndash; fine.</p></li>
<li><p>A lot more front-back variation than side-to-side, probably to be expected</p></li>
<li><p>Shots made by MIN, DET, SAS close to the net and DAL, GSW, NYK far away somewhat interesting. Fairly big difference here actually which can probably be chalked up to specific players</p></li>
<li><p>Shots made <em>against</em> probably more interesting. MIL way down at the bottom, GSW significantly at the top. What about these teams&#8217; defensive style means they are more inclined to allow shots close or far from the net?</p></li>
</ul>


<p>Sketch (not poblished):</p>

<p>Average Shot Location by Team by Win/Loss - NBA Regular Season 2012-13</p>

<p><a href="http://alekseynp.com/wp-content/uploads/2013/11/sketch_wins_losses_byteam_v22.png"><img src="http://alekseynp.com/wp-content/uploads/2013/11/sketch_wins_losses_byteam_v22.png" alt="sketch_wins_losses_byteam_v2" /></a></p>

<p>Every line represents a team and connects the two points for that team. The white dot for a team is the average location of shots attempted in games that team won. The black dot for a team is the average location of shots attempted in games that team lost.</p>

<p>Analysis:</p>

<ul>
<li><p>Most wins and losses points are near one another</p></li>
<li><p>Lines generally do not cross</p></li>
<li><p>There are a number of teams across the middle of the chart who attempt shots closer to the net more often when they win</p></li>
<li><p>Variation is left/right variation is probably just statistical noise</p></li>
</ul>


<p>Same chart but filtering for only successful shots&hellip; same story, though less evidence that closer shots are important for winning:</p>

<p><a href="http://alekseynp.com/wp-content/uploads/2013/11/sketch_wins_losses_byteam_made_v2.png"><img src="http://alekseynp.com/wp-content/uploads/2013/11/sketch_wins_losses_byteam_made_v2.png" alt="sketch_wins_losses_byteam_made_v2" /></a></p>

<p>We could also look at the games for an individual team&hellip; and I think learn nothing:</p>

<p><a href="http://alekseynp.com/wp-content/uploads/2013/11/1610612737-.png"><img src="http://alekseynp.com/wp-content/uploads/2013/11/1610612737-.png" alt="1610612737" /></a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/10/24/update-average-shot-locations-nba-regular-season-2012-13/">Update: Average Shot Locations - NBA Regular Season 2012-13</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-10-24T14:45:40-07:00'><span class='date'><span class='date-month'>Oct</span> <span class='date-day'>24</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>2:45 pm</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>Here are two updated charts following up from my<a href="http://alekseynp.com/2013/10/13/average-made-shot-location-nba-regular-season-2012-13/"> previous post</a>.</p>

<p><a href="http://alekseynp.com/wp-content/uploads/2013/10/wgtavg_made_location_top50scorers_201213_regular.png"><img src="http://alekseynp.com/wp-content/uploads/2013/10/wgtavg_made_location_top50scorers_201213_regular.png" alt="wgtavg_made_location_top50scorers_201213_regular" /></a></p>

<p><a href="http://alekseynp.com/wp-content/uploads/2013/10/avg_made_location_top50scorers_201213_regular.png"><img src="http://alekseynp.com/wp-content/uploads/2013/10/avg_made_location_top50scorers_201213_regular.png" alt="avg_made_location_top50scorers_201213_regular" /></a></p>

<p>What&rsquo;s new?</p>

<ul>
<li><p>The players included are no longer someone else&#8217; list of 50 notable players, but rather the 50 players who scored the most points in the 2012-13 regular season</p></li>
<li><p>More of the courts lines have been included to provide greater context to the data</p></li>
<li><p>The first chart shows the average position that points are scored from. This is a weighted average that puts more emphasis on 3 pointers and further demonstrates how exceptional Stephen Curry is, as the guys at <a href="http://regressing.deadspin.com/stephen-currys-numbers-are-as-unlikely-and-wonderful-a-1449057524">deadspin have noted</a></p></li>
<li><p>The second chart shows the average position of made shots as per the original</p></li>
</ul>


<p><strong>Collaboration</strong></p>

<p>Collaboration is an important thing. Earlier with my weak knowledge of basketball I published what I thought would be an interesting visual <a href="http://alekseynp.com/2013/10/13/average-made-shot-location-nba-regular-season-2012-13/">here</a>. Seems I was correct. But with a little conversation with the guys at <a href="deadspin.com">deadspin.com</a>, some very easy improvements could be made.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/10/14/visualising-shot-location-in-basketball/">Visualising Shot Location in Basketball</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-10-14T12:30:30-07:00'><span class='date'><span class='date-month'>Oct</span> <span class='date-day'>14</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>12:30 pm</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>Sports is full of spacial data. Data visualizers love this. Take the points and plot them by x and y location. Instantly the data is in a format that we can relate to and gain insight from. Too many data points? Aggregate and count points by region to create a head map or something similar. Want to compare two sets of points? Put two charts side-by-side. All of this is done with NBA shot position, but it has its shortcomings.</p>

<p>At stats.nba.com you can see shot charts like this:</p>

<p><a href="http://stats.nba.com/playerShotchart.html?PlayerID=201142&amp;viewShots=true&amp;zoneDetails=false&amp;zoneOverlays=false"><img src="http://alekseynp.com/wp-content/uploads/2013/10/short_chart_thumbnail.png" alt="short_chart_thumbnail" /></a> <a href="http://stats.nba.com/playerShotchart.html?PlayerID=201142&amp;viewShots=false&amp;zoneDetails=true&amp;zoneOverlays=true&amp;zone-mode=zone"><img src="http://alekseynp.com/wp-content/uploads/2013/10/shot_chart_thumbnail2.png" alt="shot_chart_thumbnail2" /></a></p>

<p>At hotshotcharts.com you can see shot charts heated by success rate:</p>

<p><a href="http://hotshotcharts.com/"><img src="http://alekseynp.com/wp-content/uploads/2013/10/shot_chart_thumbnail3.png" alt="shot_chart_thumbnail3" /></a></p>

<p>Even at the much (rightly) worshiped New York Times they&rsquo;re doing charts like this:</p>

<p><a href="http://www.nytimes.com/interactive/2012/06/11/sports/basketball/nba-shot-analysis.html?_r=0"><img src="http://alekseynp.com/wp-content/uploads/2013/10/shot_chart_thumbnail4.png" alt="shot_chart_thumbnail4" /></a></p>

<p><strong>Shotcomings</strong></p>

<p>I would say that the number one shortcoming of these charts is the difficultly in comparing two sets of points. Take the New York Times piece for example. Try to compare the Heat to the Thunder or the various pairs of players side-by-side. Your eyes will flick back and forth and maybe you&rsquo;ll find a difference, but it&rsquo;s hard and you can&rsquo;t help but feel that you are missing something.</p>

<p>Why? Too much data. The points are not together for easy comparison.</p>

<p><strong>Solution</strong></p>

<p>What I am experimenting with is greater use of aggregation in these circumstances. What if we take average positions to aggregate thousands of data points and then plot those averages together to gain insights?</p>

<p>Here is <a href="http://alekseynp.com/2013/10/13/average-made-shot-location-nba-regular-season-2012-13/">my first piece</a> on basketball:</p>

<p><a href="http://alekseynp.com/wp-content/uploads/2013/10/final.png"><img src="http://alekseynp.com/wp-content/uploads/2013/10/final-298x300.png" alt="final" /></a></p>

<p>Unfortunately the concept of average location is a bit abstract, and thus that creates a greater overhead of effort for the viewer to overcome before they start getting value out of the graphic. However, after that we can start to compare players in a way that we never have before. See the first post <a href="http://alekseynp.com/2013/10/13/average-made-shot-location-nba-regular-season-2012-13/">here</a>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/10/13/average-made-shot-location-nba-regular-season-2012-13/">Average Made Shot Location - NBA Regular Season 2012-13</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-10-13T12:14:35-07:00'><span class='date'><span class='date-month'>Oct</span> <span class='date-day'>13</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>12:14 pm</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://alekseynp.com/wp-content/uploads/2013/10/final.png"><img src="http://alekseynp.com/wp-content/uploads/2013/10/final.png" alt="final" /></a></p>

<p>In the 2012-13 regular season, tens of thousands of shots were taken. How can we visualize these in a useful manner? What is the average location of successful shot attempts? How do the top 50 players compare?</p>

<p>Note: In terms of magnitude, the points above fall roughly within the key.</p>

<p>Interesting observations:</p>

<ul>
<li><p>Outliers or rather, those players who are the most different:</p>

<ul>
<li><p>Omer Asik and Dwight Howard very close to the basket</p></li>
<li><p>Stephen Curry and Jarrett Jack very far from the basket</p></li>
<li><p>Kevin Martin way out to the left</p></li>
</ul>
</li>
<li><p>Right-hand bias. The majority of players are making shots on average from the right-hand side of the court</p></li>
<li><p>Trend. Notice that the dots seem to form a line.  The majority of the players are on the right-hand side and as you move further from the basket, they also move further right. This may reveal something fundamental about the game, that there is some sort of ideal-angle to be shooting from. Note that the points on the left-hand side may have a similar trend, but it&rsquo;s not as strong.</p></li>
</ul>


<p>Know something about basketball? What insights do you get from this chart?</p>

<p>More about this from a data visualization perspective in another post.</p>

<p>See also my work on the average passing direction in the English Premier League (Football (Soccer)):</p>

<p><a href="http://alekseynp.com/portfolio/mcfc-opta-passing-permier-league-2011-12.html"><img src="http://alekseynp.com/wp-content/uploads/2012/08/passingDirection1.png" alt="passingDirection" /></a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/09/30/venezuelan-bat-pie/">Venezuelan Bat Pie</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-09-30T21:59:14-07:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>30</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>9:59 pm</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>Pointing out failures of the Venezuelan government can be a little too easy at times.</p>

<p>Today, points for creativity, but the 3-dimensional Venezuelan pie is an absolute technical failure.</p>

<p>Case in point, compare the yellow 12% slice to the 25% and 48% slices. The reader has no chance to use either area or angles to compare the data values, and are left simply to read the values and ignore the visual aid.</p>

<p><a href="http://alekseynp.com/wp-content/uploads/2013/10/DSC_8769.jpg"><img src="http://alekseynp.com/wp-content/uploads/2013/10/DSC_8769-1024x685.jpg" alt="DSC_8769" /></a></p>

<p><a href="http://alekseynp.com/wp-content/uploads/2013/10/DSC_8768.jpg"><img src="http://alekseynp.com/wp-content/uploads/2013/10/DSC_8768-685x1024.jpg" alt="DSC_8768" /></a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/08/29/which-countries-are-successfully-requesting-data-from-facebook/">Which Countries Are Successfully Requesting Data From Facebook?</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-08-29T08:33:42-07:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>29</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>8:33 am</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://alekseynp.com/wp-content/uploads/2013/08/facebook_requests_v1_publish.png"><img src="http://alekseynp.com/wp-content/uploads/2013/08/facebook_requests_v1_publish.png" alt="facebook_requests_v1_publish" /></a></p>

<p>Recently <a href="http://newsroom.fb.com/News/699/Global-Government-Requests-Report">Facebook published a report</a> covering the first 6 months of 2013, disclosing which countries have made data requests from Facebook, and to what proportion of requests did Facebook respond with at least some data. &ldquo;Transparency and trust are core values at Facebook.&rdquo; And good on them for at least trying not to be evil. Unfortunately, in this case &ldquo;transparency&rdquo; has amounted to a single HTML table with 71 rows of data. Given the enormous audience for this information, perhaps some data visualisation would have been appropriate. After all, what is &ldquo;transparency&rdquo; if people can&rsquo;t really &ldquo;see&rdquo; the data?</p>

<p><strong>Proportionality - Requests vs. Facebook Population</strong></p>

<p>I was going to combine the requests data with Facebook populations, but it <a href="http://www.motherjones.com/kevin-drum/2013/08/chart-day-which-countries-snoop-facebook-users-most">looks like this has already been done</a>. This is a classic example of the importance of relative ratios in data reporting and journalism. The result is also important given the position of Germany in the current debate on web privacy. I encourage you to take a look <a href="http://www.motherjones.com/kevin-drum/2013/08/chart-day-which-countries-snoop-facebook-users-most">here</a>.</p>

<p><strong>Successful Requests</strong></p>

<p>Facebook tells us that it is battling hard against any and all requests, and that it only complies with the strict letter of the law. Still it would be interesting to see which countries are more successful than others. We could do this simply by looking at the success ratio in the report, but plotting it against number of requests adds an interesting dimension.</p>

<p>Without being an expert in online data privacy and international law, it&rsquo;s interesting to note a few things:</p>

<ul>
<li><p>In the bottom left, countries who have made few requests with very little success</p></li>
<li><p>In the top-right, countries who have made a lot of requests with good success</p>

<ul>
<li><p>United States, United Kingdom, and Australia leading the pack</p></li>
<li><p>Canada not together with those nations above</p></li>
<li><p>Italy, France, Germany, Spain, Portugal clustered - Western Schengen</p></li>
<li><p>Switzerland and Austria with much lower success rates than those nations above</p></li>
</ul>
</li>
<li><p>Poland a proliferate requester with remarkably little success</p></li>
</ul>


<p><strong>Meta</strong></p>

<p>Logarithmic scales are probably not the best practice in data journalism, but it was worth it in order to spread out the dots and see the different countries.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/08/26/how-to-make-a-heat-map-with-hexagons-d3-js-hexbins-js-open-street-map-inkscape-and-paint-net/">How to Make a Heat Map With Hexagons, D3.js, hexbins.js, Open Street Map, Inkscape, and Paint.NET</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-08-26T14:55:06-07:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>26</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>2:55 pm</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>In this post I will be showing how I made my map for the post, <a href="http://alekseynp.com/2013/08/17/average-age-of-brooklyns-buildings-mapped/">Average age of Brooklyn&rsquo;s buildings mapped</a>.</p>

<p><a href="http://alekseynp.com/wp-content/uploads/2013/08/bk_r5_version4.png"><img src="http://alekseynp.com/wp-content/uploads/2013/08/bk_r5_version4-150x150.png" alt="bk_r5_version4" /></a></p>

<p>I did it with:</p>

<ul>
<li><p>Completely open source tools</p></li>
<li><p>D3.js and hexbins.js to render in Firefox</p></li>
<li><p>Inkscape and Paint.NET for graphical editing</p></li>
<li><p>Open Street Map for the basemap</p></li>
</ul>


<p><strong>Overall Technique</strong></p>

<p>The overall technique is based on using D3.js offline in the browser on a one-off basis to create a static visual that you will use elsewhere. I outline the technique here in my post, <a href="http://alekseynp.com/2013/08/19/use-d3-js-on-your-desktop-to-publish-static-visualisations/">Use D3.js on your desktop to publish static visualisations</a></p>

<p><strong>Get Data</strong></p>

<p>You can get the CSV I used <a href="http://www.nyc.gov/html/dcp/html/bytes/dwn_pluto_mappluto.shtml">here</a>. The hexbins.js doesn&rsquo;t do so well with missing values, so I cleaned out all of the records with missing values and re-saved the CSV. Additionally I removed most of the columns which are unnecessary and really bulk up the file.</p>

<p><strong>Creating the Heat for the Map</strong></p>

<p>First of all we&rsquo;re going to be using <a href="http://d3js.org/">D3.js</a> along with <a href="https://github.com/indiemaps/hexbin-js">hexbins.js</a>. You can read a lot about hexbins.js <a href="http://indiemaps.com/blog/2011/10/hexbins/">here</a>.</p>

<pre><code>&lt;code&gt;&lt;code&gt;&lt;span style="font-family: Consolas, Monaco, monospace;"&gt;&lt;span style="line-height: 18px;"&gt;&lt;script type="text/javascript" src="d3.v3.js"&gt;&lt;/script&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;script src="hexbin.js"&gt;&lt;/script&gt;
&lt;/code&gt;
</code></pre>

<p>Using D3.js as you normally would, and I&rsquo;m not going to give a complete tutorial on that here&hellip;</p>

<p>The full code listing is at the bottom of this post.</p>

<p>First of all, add an SVG to the document. This is probably not the best way to manage widths, margins, etc., but remember this only has to work once and well enough, so elegance of code is not important. Below we have a chart that will be 1100 x 1100 with 50 padding around the outside.</p>

<pre><code>&lt;code&gt;var chartHeight = 1000;
var chartWidth = 1000;

var svg = d3.select("#chart").append("svg")
  .attr("height", chartHeight+100)
  .attr("width", chartWidth+100)
  .append("g")
    .attr("transform", "translate(50,50)");
&lt;/code&gt;
</code></pre>

<p>Now we create two scales to translate the XCoord and YCoord from the Brooklyn data into coordinates in our chart. We are translating 973045 to 0 and 1024202 to chartWidth which is 1000 and using a linear interpolation for x. Similarly for y. Note that this is possibly a HUGE MISTAKE when it comes to dealing with maps. If you&rsquo;re going to work with maps, then you may have to learn about projections. The fundamental thing here is that translating the 3D points on the surface of the earth to 2D points on the surface of a computer screen is not at all straightforward, and you will always have to use a projection of some sort. Here I am using a linear projection which can be fine, but if I combine this later with a basemap that isn&rsquo;t on a linear projection, big, visible errors could be introduced. In this case, the basemap is small enough that those errors aren&rsquo;t big and aren&rsquo;t visible, so it&rsquo;s not a big deal.</p>

<pre><code>&lt;code&gt;var x = d3.scale.linear()
  .range([0, chartWidth])
  .domain([973045,1024202]);

var y = d3.scale.linear()
  .domain([146940, 208432])
  .range([chartHeight, 0]);
&lt;/code&gt;
</code></pre>

<p>Now we create the scale that we will be using to create the &ldquo;heat&rdquo; in the map. We will use this to control the opacity.  Here we are translating 1870 to 0 opacity and 2013 to 1.</p>

<pre><code>&lt;code&gt;  var opacity = d3.scale.linear()
    .domain([1870, 2013])
    .range([0,1]);    
&lt;/code&gt;
</code></pre>

<p>Now we use D3 to load the CSV data as usual. The code that follows later comes from the ellipses below.</p>

<pre><code>&lt;code&gt;d3.csv("bk-xybuild-nomissing.csv",function(data) {
...
});
&lt;/code&gt;
</code></pre>

<p>Now we use hexbins.js for the first time. We create a new hexbin that is 1000 x 1000 where the hexagons have a &ldquo;radius&rdquo; of 30. We also teach the hexbin how to retrieve the x and y to use when we pass it the data. In this case we will give it values converted by the scales x() and y() that we created above that come from the CSV data.</p>

<pre><code>&lt;code&gt;  var hexbin = d3.hexbin()
    .size([chartWidth, chartHeight])
    .radius(30)
    .x(function(d) {return x(d.XCoord);})
    .y(function(d) {return y(d.YCoord);});
&lt;/code&gt;
</code></pre>

<p>Now we run the hexbin algorithm on our data. This will return an object that where every data point has been assigned to a hexagon.</p>

<pre><code>&lt;code&gt;  hexBinsData = hexbin(data);    
&lt;/code&gt;
</code></pre>

<p>Now we create a special function that we will use to calculate the average for each hexagon. It takes in d which is the array of data points assigned to the hexagon, and calculated the average of YearBuilt for that hexagon.</p>

<pre><code>&lt;code&gt;  var averageFunction = function(d) {
    var sum = 0;
    for(var i = 0; i &lt; d.length; i++)
    {
      sum += +d[i].YearBuilt;
    }
    return sum/d.length;
  };
&lt;/code&gt;
</code></pre>

<p>Finally we do the very normal D3 thing of binding the hexBinsData to hexagon paths in the SVG. We give them a class of hexagon, a path as defined by hexbin.hexagon(), a transform to translate the hexagon by it&rsquo;s x and y coordinate, and a fill colour. Finally we also change the fill-opacity. We use the averageFunction to calculate the average YearBuilt for the hexagon, and then we convert it using our opacity scale to a value between 0 and 1.</p>

<pre><code>&lt;code&gt;  svg.selectAll(".hexagon")
    .data(hexBinsData).enter()
    .append("path")
      .attr("class", "hexagon")
      .attr("d", hexbin.hexagon())
      .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; })
      .style("fill", "#0000FF")
      .style("fill-opacity", function(d) { return opacity(averageFunction(d)); });
&lt;/code&gt;
</code></pre>

<p>The result should look something like this:</p>

<p><a href="http://alekseynp.com/wp-content/uploads/2013/08/radius_5_400.png"><img src="http://alekseynp.com/wp-content/uploads/2013/08/radius_5_400-150x150.png" alt="radius_5_400" /></a></p>

<p><strong>Extract SVG from the Browser</strong></p>

<p>Use Firefox to copy and paste the SVG that is generated out of the browser, into a text editor, and save it off as an SVG file. I explain more here: <a href="http://alekseynp.com/2013/08/19/use-d3-js-on-your-desktop-to-publish-static-visualisations/">Use D3.js on your desktop to publish static visualisations</a></p>

<p><strong>Get a Basemap from Open Street Map</strong></p>

<p>Open Street Map is great. If you aren&rsquo;t aware of it, then you should be. I tell people it&rsquo;s like &ldquo;Wikipedia, but for maps&rdquo; which is accurate enough. I&rsquo;ve used Open Street Map to navigate 20,000 km of driving through 7 countries in South America at the time of writing this post, so I can say it&rsquo;s pretty good.</p>

<p>With the heat we created above, we want to layer this on top of a map of Brooklyn.</p>

<p>Go to <a href="http://www.openstreetmap.org/">http://www.openstreetmap.org</a> and click on the Share icon on the right-hand side.</p>

<p><a href="http://alekseynp.com/wp-content/uploads/2013/08/share.png"><img src="http://alekseynp.com/wp-content/uploads/2013/08/share.png" alt="share" /></a></p>

<p>You will see a menu that allows you to export PNGs from Open Street Map. There are some practical limits to how much detail you are allowed to get based on how large an area you select, but in any case it should be sufficient to make a large-ish map. If not, maybe you&rsquo;ll have to piece together some pieces manually.</p>

<p><a href="http://alekseynp.com/wp-content/uploads/2013/08/image.png"><img src="http://alekseynp.com/wp-content/uploads/2013/08/image.png" alt="image" /></a></p>

<p><strong>Convert SVG to PNG</strong></p>

<p>Since our OSM data is in PNG format, we&rsquo;ll want our heat to be as well. We could operate in SVG, but that can be very computer intensive with map data. Open the SVG in Inkscape and convert to a PNG.</p>

<p><strong>Combine with Paint.NET</strong></p>

<p>Not much to say here. I took the PNG from OSM, I black-and-white-ed it, then pasted in a layer on top the heat and adjusted it&rsquo;s position and size until it matched the data below. In this instance I was able to line up the water and green space with the data, as there was no BuildYear data for these places. For other data, lining up with the map would be more complicated.</p>

<p><strong>Done!</strong></p>

<p>264,534 data points aggregated onto one heatmap of Brooklyn all using free open source tools and nothing specialized for map-making</p>

<p><strong>Full JavaScript code listing:</strong></p>

<pre><code>&lt;code&gt;var chartHeight = 1000;
var chartWidth = 1000;

var svg = d3.select("#chart").append("svg")
  .attr("height", chartHeight+100)
  .attr("width", chartWidth+100)
  .append("g")
    .attr("transform", "translate(50,50)");

var x = d3.scale.linear()
  .range([0, chartWidth])
  .domain([973045,1024202]);

var y = d3.scale.linear()
  .domain([146940, 208432])
  .range([chartHeight, 0]);

d3.csv("bk-xybuild-nomissing.csv",function(data) {
  var hexbin = d3.hexbin()
    .size([chartWidth, chartHeight])
    .radius(30)
  .x(function(d) {return x(d.XCoord);})
  .y(function(d) {return y(d.YCoord);});

  var opacity = d3.scale.linear()
    .domain([1870, 2013])
    .range([0,1]);  

  hexBinsData = hexbin(data);  

  var averageFunction = function(d) {
    var sum = 0;
  for(var i = 0; i &lt; d.length; i++)
  {
    sum += +d[i].YearBuilt;
  }
  return sum/d.length;
  };

  svg.selectAll(".hexagon")
    .data(hexBinsData).enter()
  .append("path")
      .attr("class", "hexagon")
      .attr("d", hexbin.hexagon())
      .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; })
    .style("fill", "#0000FF")
      .style("fill-opacity", function(d) { return opacity(averageFunction(d)); });
});
&lt;/code&gt;
</code></pre>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/08/20/small-multiples-of-pies-from-the-economist/">Small Multiples of Pies From the Economist?</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-08-20T09:54:37-07:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>20</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>9:54 am</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>Really guys?</p>

<p><a href="http://www.economist.com/blogs/graphicdetail/2013/08/daily-chart-12?fsrc=rss">http://www.economist.com/blogs/graphicdetail/2013/08/daily-chart-12?fsrc=rss</a></p>

<p>Pie charts can be used to show a part-to-whole relationship with a relatively small number of parts. That is, if you have something that breaks down into 5 or so parts, then you can use a pie to show it. If you have 10 decades and they are ordinal, that is they have a natural ordering to them, then you might be tempted to do what The Economist did below&hellip; But don&rsquo;t!</p>

<p>All you have to do is try and use the chart at the top to answer simple questions like: Which is the most popular? More difficult, which is second most? How much more or less popular are the 50s vs the 80s?</p>

<p><a href="http://www.economist.com/blogs/graphicdetail/2013/08/daily-chart-12?fsrc=rss"><img src="http://cdn.static-economist.com/sites/default/files/imagecache/595-width-retina/20130824_GDC239_1190.png" alt="" /></a></p>

<p>Obviously I&rsquo;m going to recommend a bar chart instead, which would have a different aspect ratio and might not work well in the space allowed by the graphic. A good alternative to a bar chart would be to put in a line in each of the charts representing the average result. I&rsquo;ve sketched it below:</p>

<p><a href="http://alekseynp.com/wp-content/uploads/2013/08/economist_better.png"><img src="http://alekseynp.com/wp-content/uploads/2013/08/economist_better-973x1024.png" alt="economist_better" /></a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/08/18/use-d3-js-on-your-desktop-to-publish-static-visualisations/">Use D3.js on Your Desktop to Publish Static Visualisations</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-08-18T17:03:48-07:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>18</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>5:03 pm</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>D3.js is a great tool for creating &ldquo;Data Drive Documents&rdquo;. As a JavaScript library, its natural primary use is on the web, rendering visualizations in the browser. It can also, however, be used offline on your PC to generate data driven content on a one-off basis. For someone familiar with D3, it can be a rapid and powerful way of scripting data into visual elements for use in a project that will not necessarily be published live and interactive on the web. In this post I will outline my simple method for using D3.js to script elements in static work.</p>

<p><strong>Use D3.js to render content in the browser</strong></p>

<p>Use D3 as you normally would to load CSVs and bind data to document elements. It doesn&rsquo;t have to be polished, properly wired together, or compatible with various browsers. This only has to work once, well enough, and on your machine in order to move it on to the next step in your process. It can get whatever polish it needs later in your graphical editing programs. JavaScript in the browser is your chance to do anything in a scripted way that would otherwise be a huge pain. The truth is, you could create all kinds of data visualisations by hand with an infinite amount of time and patience to calculate values and draw rectangles of exactly the right length and shade. But you don&rsquo;t.</p>

<p>Use Firefox. Like the rest of the world I&rsquo;ve moved on to Chrome, but I still have Firefox installed on my computer for this purpose. I neither know nor need to know the full technical detail on this, but certain security settings to prevent cross site scripting attacks make it difficult to use D3.js to load CSV data locally from your machine in Chrome and Internet Explorer. There ways around this by running a tiny webserver on your desktop, but I find the simplest thing is to use Firefox which seems to not be quite so picky about its security on this issue.</p>

<p><strong>Export SVG from the browser</strong></p>

<p>Now that you&rsquo;ve used D3 to render SVG in the browser based on your data, you can reach into that content and extract it and save it off to a file!</p>

<p>Firefox comes with its own inspector, so you don&rsquo;t even have to use Firebug. If you right click on your image and pick Inspect Element, you should gain access to a tree-view of the Document Objecet Model that will allow you to find the code for your svg. It will look like <svg>&hellip;stuffhere&hellip;</svg></p>

<p><a href="http://alekseynp.com/wp-content/uploads/2013/08/innerhtml.png"><img src="http://alekseynp.com/wp-content/uploads/2013/08/innerhtml.png" alt="innerhtml" /></a></p>

<p>In this example here, the SVG content we want is &ldquo;<svg height="1100" width="1100" > .. </svg>. All this is just a bunch of text and we want to get it onto the clipboard. The way we do this is to right-click on the node that contains the SVG and choose Copy Inner HTML. In this case that is the <div id="chart" >.</p>

<p>Now that the SVG is on the clipboard, now what? Open up a text editor (maybe Notepad, maybe Notepad++), paste in the text and save it off as a &ldquo;.svg&rdquo; file.</p>

<p><strong>Use Inkscape to access SVG content</strong></p>

<p>****There&rsquo;s not really much more to be said here. If you open up your new SVG file with Inkscape, you&rsquo;ll find it malleable and in your hands like any other graphic. Combine, edit, and label. Publish.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/08/16/average-age-of-brooklyns-buildings-mapped/">Average Age of Brooklyn&#8217;s Buildings Mapped</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-08-16T21:12:25-07:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>16</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>9:12 pm</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>I saw <a href="http://bklynr.com/block-by-block-brooklyns-past-and-present/">this</a> recently <a href="http://www.theatlanticcities.com/neighborhoods/2013/08/interactive-map-day-brooklyns-buildings-are-newer-you-think/6399/">here</a>. It&rsquo;s a map showing the age of Brooklyn&rsquo;s buildings.</p>

<p><a href="http://alekseynp.com/wp-content/uploads/2013/08/bklynr.png"><img src="http://alekseynp.com/wp-content/uploads/2013/08/bklynr.png" alt="bklynr" /></a></p>

<p><strong>What do I get from the map?</strong></p>

<p>Every data point is plotted, so if I were a Brooklyner, I would probably find my street or look up my favourite building. For some people this seems to have reduced confidence in the data quality. Having only ever been half-way across the Brooklyn Bridge, instead I looked at the map to try and find interesting trends. Some are certainly visible, but I found myself wanting a map with some aggregation.</p>

<p><strong>What I tried.</strong></p>

<p>So I made this. Yes, a post will follow on how.</p>

<p><a href="http://alekseynp.com/wp-content/uploads/2013/08/bk_r5_version4.png"><img src="http://alekseynp.com/wp-content/uploads/2013/08/bk_r5_version4-923x1024.png" alt="bk_r5_version4" /></a></p>

<p>(click for the huge version)</p>

<p>By showing the average build year for buildings in each hexagon, rather than plotting every single data point, some patterns are more visible. Though I will admit that once you&rsquo;ve seen them in the above map, they are often quite visible in the original.</p>

<p><strong>Hexagon Size</strong></p>

<p>The size or &ldquo;radius&rdquo; of the hexagons is an important parameter of the visualization. As you can see clearly below, our ability to spot patterns of a certain size requires aggregation of a similar size. Compare the first with the last and you&rsquo;ll see.</p>

<p><a href="http://alekseynp.com/wp-content/uploads/2013/08/radius_5_400.png"><img src="http://alekseynp.com/wp-content/uploads/2013/08/radius_5_400.png" alt="radius_5_400" /></a><a href="http://alekseynp.com/wp-content/uploads/2013/08/radius_10_4001.png"><img src="http://alekseynp.com/wp-content/uploads/2013/08/radius_10_4001.png" alt="radius_10_400" /></a><a href="http://alekseynp.com/wp-content/uploads/2013/08/radius_20_400.png"><img src="http://alekseynp.com/wp-content/uploads/2013/08/radius_20_400.png" alt="radius_20_400" /></a><a href="http://alekseynp.com/wp-content/uploads/2013/08/radius_30_400.png"><img src="http://alekseynp.com/wp-content/uploads/2013/08/radius_30_400.png" alt="radius_30_400" /></a></p>

<p><strong>Aggregation</strong></p>

<p>While my map is not a compelling improvement on the original, I think it is a nice demonstration of the power of aggregation. Data visualizers can be overly focused on plotting the data directly. Analysts, however, know that you can rarely accomplish anything without some good aggregation. This intersection of data viz and analysis is undeniably interesting.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/4">&larr; Older</a>
    
    <a href="/archives">Blog Archives</a>
    
    <a class="next" href="/posts/2">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    
  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Aleksey Nozdryn-Plotnicki -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a> | Themed with <a href="https://github.com/lucaslew/whitespace">Whitespace</a></span>
</p>

</footer>
  










  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
